(function(e){function n(e){if(typeof e=="undefined"){return false}else{return true}}function r(t,r){if(n(r.columns)&&n(r.rows)){e.error("gentleSelect: You cannot supply both 'rows' and 'columns'");return true}if(n(r.columns)&&!n(r.itemWidth)){e.error("gentleSelect: itemWidth must be supplied if 'columns' is specified");return true}if(n(r.rows)&&!n(r.itemWidth)){e.error("gentleSelect: itemWidth must be supplied if 'rows' is specified");return true}if(!n(r.openSpeed)||typeof r.openSpeed!="number"&&typeof r.openSpeed=="string"&&r.openSpeed!="slow"&&r.openSpeed!="fast"){e.error('gentleSelect: openSpeed must be an integer or "slow" or "fast"');return true}if(!n(r.closeSpeed)||typeof r.closeSpeed!="number"&&typeof r.closeSpeed=="string"&&r.closeSpeed!="slow"&&r.closeSpeed!="fast"){e.error('gentleSelect: closeSpeed must be an integer or "slow" or "fast"');return true}if(!n(r.openEffect)||r.openEffect!="fade"&&r.openEffect!="slide"){e.error("gentleSelect: openEffect must be either 'fade' or 'slide'!");return true}if(!n(r.closeEffect)||r.closeEffect!="fade"&&r.closeEffect!="slide"){e.error("gentleSelect: closeEffect must be either 'fade' or 'slide'!");return true}if(!n(r.hideOnMouseOut)||typeof r.hideOnMouseOut!="boolean"){e.error('gentleSelect: hideOnMouseOut must be supplied and either "true" or "false"!');return true}return false}function i(e,t){if(e.attr("multiple")){t.hideOnMouseOut=true}}function s(t,n){if(t.length<1){return n.prompt}if(n.maxDisplay!=0&&t.length>n.maxDisplay){var r=t.slice(0,n.maxDisplay).map(function(){return e(this).text()});r.push("...")}else{var r=t.map(function(){return e(this).text()})}return r.get().join(", ")}function o(t,n){var t=e(t);if(t.attr("multiple")&&n.disallowEmpty){var r=t.data("dialog").find("li"),i=r.filter(".selected");r.removeClass("sole-selected");if(i.length==1){i.addClass("sole-selected")}}}var t={minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined,prompt:"Make A Selection",maxDisplay:0,openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",disallowEmpty:false,hideOnMouseOut:true};var u={init:function(u){var f=e.extend({},t,u),l=this.find("option");if(r(this,f)){return this}i(this,f);this.hide();if(this.attr("multiple")&&f.disallowEmpty){if(l.length==0){e.error("gentleSelect: disallowEmpty conflicts with empty <select>")}if(this[0].selectedIndex<0){this[0].selectedIndex=0}}label_text=s(this.find(":selected"),f);var c=e("<span class='gentleselect-label'>"+label_text+"</span>").insertBefore(this).bind("mouseenter.gentleselect",a.labelHoverIn).bind("mouseleave.gentleselect",a.labelHoverOut).bind("click.gentleselect",a.labelClick).data("root",this);this.data("label",c).data("options",f);var h=e("<ul></ul>");l.each(function(){var t=e("<li>"+e(this).text()+"</li>").data("value",e(this).attr("value")).data("name",e(this).text()).appendTo(h);if(e(this).attr("selected")){t.addClass("selected")}});var p=e("<div class='gentleselect-dialog'></div>").append(h).insertAfter(c).bind("click.gentleselect",a.dialogClick).bind("mouseleave.gentleselect",a.dialogHoverOut).data("label",c).data("root",this);this.data("dialog",p);if(n(f.columns)||n(f.rows)){h.css("float","left").find("li").width(f.itemWidth).css("float","left");var d=h.find("li:first");var v=f.itemWidth+parseInt(d.css("padding-left"))+parseInt(d.css("padding-right"));var m=h.find("li").length;if(n(f.columns)){var g=parseInt(f.columns);var y=Math.ceil(m/g)}else{var y=parseInt(f.rows);var g=Math.ceil(m/y)}p.width(v*g);for(var b=0;b<y*g-m;b++){e("<li style='float:left' class='gentleselect-dummy'><span>&nbsp;</span></li>").appendTo(h)}var w=[];var E=0;h.find("li").each(function(){if(E<y){w[E]=e(this)}else{var t=E%y;e(this).insertAfter(w[t]);w[t]=e(this)}E++})}else if(typeof f.minWidth=="number"){p.css("min-width",f.minWidth)}if(n(f.title)){e("<div class='gentleselect-title'>"+f.title+"</div>").prependTo(p)}e(document).bind("keyup.gentleselect",a.keyUp);o(this,f);return this},update:function(){var t=this.data("options");var n=this.attr("multiple")&&this.val()?this.val():[this.val()];e("li",this.data("dialog")).each(function(){var t=e(this);var r=e.inArray(t.data("value"),n)!=-1;t.toggleClass("selected",r)});var r=s(this.find(":selected"),t);this.data("label").text(r);o(this,t);return this},clear:function(){if(this.data("options").disallowEmpty){e.error("gentleSelect: cannot use 'clear' when disallowEmpty=true");return this}this[0].selectedIndex=-1;return u["update"].call(this)}};var a={labelHoverIn:function(){e(this).addClass("gentleselect-label-highlight")},labelHoverOut:function(){e(this).removeClass("gentleselect-label-highlight")},labelClick:function(){var t=e(this);var n=t.position();var r=t.data("root");var i=r.data("options");var s=r.data("dialog").css("top",n.top+t.height()).css("left",n.left+1);if(i.openEffect=="fade"){s.fadeIn(i.openSpeed)}else{s.slideDown(i.openSpeed)}},dialogHoverOut:function(){var t=e(this);if(t.data("root").data("options").hideOnMouseOut){t.hide()}},dialogClick:function(t){var n=e(t.target);var r=e(this);var i=r.data("root");var u=i.data("options");if(!i.attr("multiple")){if(u.closeEffect=="fade"){r.fadeOut(u.closeSpeed)}else{r.slideUp(u.closeSpeed)}}if(n.is("li")&&!n.hasClass("gentleselect-dummy")){var a=n.data("value");var f=n.data("name");var l=r.data("label");if(r.data("root").attr("multiple")){if(u.disallowEmpty&&n.hasClass("selected")&&i.find(":selected").length==1){return}n.toggleClass("selected");var c=r.find("li.selected");l.text(s(c,u));var h=c.map(function(){return e(this).data("value")});i.val(h.get()).trigger("change");o(i,u)}else{r.find("li.selected").removeClass("selected");n.addClass("selected");l.text(n.data("name"));i.val(a).trigger("change")}}},keyUp:function(t){if(t.keyCode==27){e(".gentleselect-dialog").hide()}}};e.fn.gentleSelect=function(t){if(u[t]){return u[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return u.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.gentleSelect")}}})(jQuery)